---
title: Creating an R Package (for the first time!)
author: ''
date: '2019-12-11'
slug: creating-an-r-package-for-the-first-time
categories: []
tags:
  - R
  - packages
showDate: true
draft: true
---

Recently, I was creating an R package for the first time.^[Technically, it wasn't really my first time. I think I had to make one for a class 2 years ago, which is basically an eternity.] There are already a lot of great resources online for this task, such as [Hilary Parker's brief tutorial](https://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/) or [Jeff Leek's guide](https://github.com/jtleek/rpackages) or [Hadley Wickham's book](http://r-pkgs.had.co.nz/intro.html) (in increasing order of detail).^[Note: large portions of this post are borrowed from their tutorials.] But I thought it would still be worthwhile to walk through how exactly I made mine, since otherwise, I will probably run into the same hiccups again (and be frustrated that I didn't write a guide for myself!).

Here is a step-by-step guide to building a minimal R package.

## Step 1: Set up your packages and directory

To create your own R package, we will need to use two packages, `devtools` and `roxygen2`. `devtools` contains the functions for building a package, while `roxygen2` helps generate documentation for the package using specially formatted comments.

```{r eval = F}
library(devtools)
library(roxygen2)
```

Now navigate to the parent directory of where you want your R package directory to be located (e.g. `R_packages`). Use the function `create` to create the folder for the R package, which I will call `mypackage` in this tutorial.

```{r eval = F}
setwd("R_packages")
create("mypackage")
```

Your `R_packages/mypackage` directory should now look like the following:

![Contents of `mypackage`:](/post/2019-12-11-creating-an-r-package-for-the-first-time_files/file_structure.png)

* `DESCRIPTION` - information about the package
* `mypackage.Rproj` - the Rproj file
* `NAMESPACE` - information about what to import and export (ignore for now, since it will be automatically regenerated by roxygen2 later)
* `R` - a directory for your scripts, i.e. where your functions will go 

At this point, you can (should) create a git repository and connect it to GitHub. Navigate to https://github.com and create a new repository there with the same name (e.g. "mypackage"). Then run the following commands in your terminal.

```{bash eval = F}
cd mypackage # Navigate to mypackage directory
git init
git remote add origin https://github.com/albertkuo/mypackage.git
git add *
git commit -m "Initial commit"
git push -u origin master
```

Aside from the usual benefits that come with using version control, making your R package a GitHub repo means that later on, other people can easily install your package directly from GitHub with the command `devtools::install_github("albertkuo/mypackage")`.

## Step 2: Write DESCRIPTION

Now edit DESCRIPTION with your favorite text editor. This file basically contains some information about the package. Below is an example.

```{bash eval = F}
Package: mypackage
Title: What the Package Does (One Line, Title Case, No Period)
Version: 0.1.0 # following Leek's versioning convention
Date: 2019-12-11
Authors@R: c(person(given = "Albert",
                    family = "Kuo",
                    role = c("aut", "cre"), # aut means author (someone who has 
                                            # made a significant contribution) 
                                            # and cre means maintainer (who to 
                                            # contact if there are problems)
                    email = "albertkuo@jhu.edu",
                    comment = c("ORCID" = "0000-0001-5155-0748")))
Depends: R (>= 3.6.1)
Imports: packages you need, aka dependencies # e.g. dplyr
Suggests: optional packages # e.g. knitr, for building vignettes
Description: What the package does (one paragraph).
License: GPL-3
Encoding: UTF-8
LazyData: true
```

Disclaimer: I still haven't quite figured out what the GPL-3 license means, but it seems to be a commonly recommended one for R packages.

## Step 3: Add functions and write documentation

It's likely that you already have functions that you want to create a package for. Copy these into the `R` folder. Each function should be in its own separate file.

Let's say you have a script called `my_function.R`. We want to write specially formatted comments for it so that `roxygen2` can automatically build the documentation pages for us. Below is an example

```{r eval = F}
#' A very brief description of what your function does
#'
#' A detailed description of what the function does
#'
#' @param print_statement a logical value indicating 
#' whether to print the statement (default is \code{TRUE})
#'
#' @import dplyr
#' @importFrom MASS lda
#'
#' @export
#' 
#' @return \code{my_function} prints a declaration 
#' announcing itself if the parameter is \code{TRUE}
#'
#' @examples
#' R code examples
#'
my_function <- function(print_statement = TRUE){
  if(print_statement){
    print("This is my function.")
  }
}
```

Some things I want to draw your attention to:

* Include `@export` if you want the function to be exported, i.e. visible to people who use the R package.
* Include `@import` for any packages that are needed for this function. You can also import a specific function with `@importFrom` to prevent name conflicts.a

Now we can generate the documentation files and NAMESPACE using `roxygen2`. This is as easy as typing the following command. 

```{r eval = F}
document()
```

Your `R_packages/mypackage` directory should now look like the following:

![Contents of `mypackage`](/post/2019-12-11-creating-an-r-package-for-the-first-time_files/file_structure_2.png)

The documentation files are the help files that can be accessed by typing `?myfunction`. They are located in the `man/` directory. 

The NAMESPACE file tells you which functions you are exporting from your package and which packages/functions you are importing to be used in your package.

Every time you make changes to the comments, you will want to regenerate the documentation and NAMESPACE with the `document()` command. 

## Step 4: Add internal data

Something else that you might want to do is to use data internally within your R package. For example, your functions might require the use of some internal data that you want to load.

To do this, first run the following command

```{r eval = F}
usethis::use_data_raw("generate_internal")
```

This will create an R script in `data-raw/generate_internal.R`, where you can put your code that generates the internal data. It will also add the `data-raw/` directory to .Rbuildignore, since you won't need it to build the package.

Then in `generate_internal.R`, you can generate  and save the internal data.

```{r eval = F}
# Generate data
x = 1:5
y = 1:10

# Save data
usethis::use_data(x, y, internal = TRUE)
```

The command `use_data` will save the objects `x` and `y` in `R/sysdata.rda`, which is a file specifically designed to hold internal data. Your functions will then be able to call the objects `x` and `y` whenever they are needed.

## Step 5: Install your package

Believe it or not, your package is ready to be installed locally on your computer. Navigate up one level to the parent directory and then use the `install` command.

```{r eval = F}
setwd("..")
install("mypackage")
library(mypackage)
```

Your package is now ready to be used! Any functions you've exported are available. For example, type `my_function(TRUE)`. You can also access the help page you generated in Step 3, just like with any other package by typing `?my_function`.

## Future work: Write tests and vignettes

At this point, you have a bare-bones, functioning R package. Even if you don't share it with anyone, this is a great way to organize and use your own functions.^[Or so I have heard. By default, I still source an R script of helper functions for my projects, but perhaps this will change as I become more comfortable with building R packages.]

However, there are two more things you will likely want to do in order to turn your minimally functioning R package into a more complete one. One of them is to write tests for your R package to check for bugs and to "[dummy proof](https://github.com/jtleek/rpackages)" your functions. The other is to write vignettes to help people learn how to use your R package. Since these things go beyond what is strictly necessary for a functioning R package, I will write about them in a later post.
